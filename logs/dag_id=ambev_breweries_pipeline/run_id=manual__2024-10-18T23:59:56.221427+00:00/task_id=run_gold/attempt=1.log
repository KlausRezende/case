[2024-10-19T00:00:08.605+0000] {taskinstance.py:1083} INFO - Dependencies all met for <TaskInstance: ambev_breweries_pipeline.run_gold manual__2024-10-18T23:59:56.221427+00:00 [queued]>
[2024-10-19T00:00:08.611+0000] {taskinstance.py:1083} INFO - Dependencies all met for <TaskInstance: ambev_breweries_pipeline.run_gold manual__2024-10-18T23:59:56.221427+00:00 [queued]>
[2024-10-19T00:00:08.611+0000] {taskinstance.py:1279} INFO - 
--------------------------------------------------------------------------------
[2024-10-19T00:00:08.612+0000] {taskinstance.py:1280} INFO - Starting attempt 1 of 1
[2024-10-19T00:00:08.612+0000] {taskinstance.py:1281} INFO - 
--------------------------------------------------------------------------------
[2024-10-19T00:00:08.621+0000] {taskinstance.py:1300} INFO - Executing <Task(BashOperator): run_gold> on 2024-10-18 23:59:56.221427+00:00
[2024-10-19T00:00:08.624+0000] {standard_task_runner.py:55} INFO - Started process 21867 to run task
[2024-10-19T00:00:08.626+0000] {standard_task_runner.py:82} INFO - Running: ['***', 'tasks', 'run', 'ambev_breweries_pipeline', 'run_gold', 'manual__2024-10-18T23:59:56.221427+00:00', '--job-id', '10', '--raw', '--subdir', 'DAGS_FOLDER/dag_brewery.py', '--cfg-path', '/tmp/tmp0xy45cd6']
[2024-10-19T00:00:08.627+0000] {standard_task_runner.py:83} INFO - Job 10: Subtask run_gold
[2024-10-19T00:00:08.638+0000] {logging_mixin.py:137} WARNING - /usr/local/lib/python3.9/site-packages/***/settings.py:249 DeprecationWarning: The sql_alchemy_conn option in [core] has been moved to the sql_alchemy_conn option in [database] - the old setting has been used, but please update your config.
[2024-10-19T00:00:08.669+0000] {task_command.py:388} INFO - Running <TaskInstance: ambev_breweries_pipeline.run_gold manual__2024-10-18T23:59:56.221427+00:00 [running]> on host 39b0b1bd9d5a
[2024-10-19T00:00:08.712+0000] {taskinstance.py:1507} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_OWNER=Klaus_Rezende
AIRFLOW_CTX_DAG_ID=ambev_breweries_pipeline
AIRFLOW_CTX_TASK_ID=run_gold
AIRFLOW_CTX_EXECUTION_DATE=2024-10-18T23:59:56.221427+00:00
AIRFLOW_CTX_TRY_NUMBER=1
AIRFLOW_CTX_DAG_RUN_ID=manual__2024-10-18T23:59:56.221427+00:00
[2024-10-19T00:00:08.713+0000] {subprocess.py:63} INFO - Tmp dir root location: 
 /tmp
[2024-10-19T00:00:08.714+0000] {subprocess.py:75} INFO - Running command: ['/usr/bin/bash', '-c', 'python3 /opt/***/scripts/gold_brewery.py']
[2024-10-19T00:00:08.721+0000] {subprocess.py:86} INFO - Output:
[2024-10-19T00:00:10.031+0000] {subprocess.py:93} INFO - Setting default log level to "WARN".
[2024-10-19T00:00:10.031+0000] {subprocess.py:93} INFO - To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
[2024-10-19T00:00:10.126+0000] {subprocess.py:93} INFO - 24/10/19 00:00:10 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
[2024-10-19T00:00:13.284+0000] {subprocess.py:93} INFO - Traceback (most recent call last):
[2024-10-19T00:00:13.284+0000] {subprocess.py:93} INFO -   File "/opt/***/scripts/gold_brewery.py", line 15, in <module>
[2024-10-19T00:00:13.285+0000] {subprocess.py:93} INFO -     df = df.withColumn('index',row_number().over(Window.partitionBy(col("id_brewery")).orderBy(col("dt_load").desc())))
[2024-10-19T00:00:13.286+0000] {subprocess.py:93} INFO -   File "/usr/local/lib/python3.9/site-packages/pyspark/sql/dataframe.py", line 5174, in withColumn
[2024-10-19T00:00:13.286+0000] {subprocess.py:93} INFO -     return DataFrame(self._jdf.withColumn(colName, col._jc), self.sparkSession)
[2024-10-19T00:00:13.286+0000] {subprocess.py:93} INFO -   File "/usr/local/lib/python3.9/site-packages/py4j/java_gateway.py", line 1322, in __call__
[2024-10-19T00:00:13.286+0000] {subprocess.py:93} INFO -     return_value = get_return_value(
[2024-10-19T00:00:13.287+0000] {subprocess.py:93} INFO -   File "/usr/local/lib/python3.9/site-packages/pyspark/errors/exceptions/captured.py", line 185, in deco
[2024-10-19T00:00:13.287+0000] {subprocess.py:93} INFO -     raise converted from None
[2024-10-19T00:00:13.291+0000] {subprocess.py:93} INFO - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `dt_load` cannot be resolved. Did you mean one of the following? [`updated_at`, `name_city`, `name_state`, `id_brewery`, `name_country`].;
[2024-10-19T00:00:13.291+0000] {subprocess.py:93} INFO - 'Project [id_brewery#0, name_brewery#1, brewery_type#2, phone_brewery#3, name_country#4, name_state_province#5, name_city#6, postal_code_brewery#7, latitude_brewery#8, longitude_brewery#9, name_address_1#10, name_address_2#11, name_address_3#12, updated_at#13, name_state#14, row_number() windowspecdefinition(id_brewery#0, 'dt_load DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS index#31]
[2024-10-19T00:00:13.291+0000] {subprocess.py:93} INFO - +- Relation [id_brewery#0,name_brewery#1,brewery_type#2,phone_brewery#3,name_country#4,name_state_province#5,name_city#6,postal_code_brewery#7,latitude_brewery#8,longitude_brewery#9,name_address_1#10,name_address_2#11,name_address_3#12,updated_at#13,name_state#14] parquet
[2024-10-19T00:00:13.292+0000] {subprocess.py:93} INFO - 
[2024-10-19T00:00:13.701+0000] {subprocess.py:97} INFO - Command exited with return code 1
[2024-10-19T00:00:13.710+0000] {taskinstance.py:1768} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/airflow/operators/bash.py", line 196, in execute
    raise AirflowException(
airflow.exceptions.AirflowException: Bash command failed. The command returned a non-zero exit code 1.
[2024-10-19T00:00:13.712+0000] {taskinstance.py:1318} INFO - Marking task as FAILED. dag_id=ambev_breweries_pipeline, task_id=run_gold, execution_date=20241018T235956, start_date=20241019T000008, end_date=20241019T000013
[2024-10-19T00:00:13.721+0000] {standard_task_runner.py:100} ERROR - Failed to execute job 10 for task run_gold (Bash command failed. The command returned a non-zero exit code 1.; 21867)
[2024-10-19T00:00:13.764+0000] {local_task_job.py:208} INFO - Task exited with return code 1
[2024-10-19T00:00:13.781+0000] {taskinstance.py:2578} INFO - 0 downstream tasks scheduled from follow-on schedule check
